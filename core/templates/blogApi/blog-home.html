{% extends 'base.html' %}
{% load static %}
{% block content %}

<!-- start banner Area -->
<section class="banner-area relative blog-home-banner" id="home">
	<div class="overlay overlay-bg"></div>
	<div class="container">
		<div class="row d-flex align-items-center justify-content-center">
			<div class="about-content blog-header-content col-lg-12">
				<h1 class="text-white">
					Dude Youâ€™re Getting
					a Telescope
				</h1>
				<p class="text-white">
					There is a moment in the life of any aspiring astronomer that it is time to buy that first
				</p>
			</div>
		</div>
	</div>
</section>
<!-- End banner Area -->

<!-- Start top-category-widget Area -->
<section class="top-category-widget-area pt-90 pb-90 ">
	<div class="container">
		<div class="row">
			<div class="col-lg-4">
				<div class="single-cat-widget">
					<div class="content relative">
						<div class="overlay overlay-bg"></div>
						<a href="#" target="_blank">
							<div class="thumb">
								<img class="content-image img-fluid d-block mx-auto"
									src="{% static 'img/blog/cat-widget1.jpg' %}" alt="">
							</div>
							<div class="content-details">
								<h4 class="content-title mx-auto text-uppercase">Social life</h4>
								<span></span>
								<p>Enjoy your social life together</p>
							</div>
						</a>
					</div>
				</div>
			</div>
			<div class="col-lg-4">
				<div class="single-cat-widget">
					<div class="content relative">
						<div class="overlay overlay-bg"></div>
						<a href="#" target="_blank">
							<div class="thumb">
								<img class="content-image img-fluid d-block mx-auto"
									src="{% static 'img/blog/cat-widget2.jpg' %}" alt="">
							</div>
							<div class="content-details">
								<h4 class="content-title mx-auto text-uppercase">Politics</h4>
								<span></span>
								<p>Be a part of politics</p>
							</div>
						</a>
					</div>
				</div>
			</div>
			<div class="col-lg-4">
				<div class="single-cat-widget">
					<div class="content relative">
						<div class="overlay overlay-bg"></div>
						<a href="#" target="_blank">
							<div class="thumb">
								<img class="content-image img-fluid d-block mx-auto"
									src="{% static 'img/blog/cat-widget3.jpg' %}" alt="">
							</div>
							<div class="content-details">
								<h4 class="content-title mx-auto text-uppercase">Food</h4>
								<span></span>
								<p>Let the food be finished</p>
							</div>
						</a>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>
<!-- End top-category-widget Area -->

<!-- Start post-content Area -->
<section class="post-content-area">
	<div class="container">
		<div class="row">
			<div class="col-lg-8 posts-list">
				<div id="posts-list"></div>

				<template id="post-template">
					<div class="single-post row">
						<div class="col-lg-3 col-md-3 meta-details">
							<ul class="tags">
								<li class="post-category"></li>
							</ul>
							<div class="user-details row">
								<p class="user-name col-lg-12 col-md-12 col-6">
									<a href="#" class="post-author"></a>
									<span class="lnr lnr-user"></span>
								</p>
								<p class="date col-lg-12 col-md-12 col-6">
									<span class="post-date"></span>
									<span class="lnr lnr-calendar-full"></span>
								</p>
								<p class="view col-lg-12 col-md-12 col-6">
									<span class="post-views"></span>
									<span class="lnr lnr-eye"></span>
								</p>
							</div>
						</div>
						<div class="col-lg-9 col-md-9">
							<div class="feature-img">
								<img class="img-fluid post-image" src="" alt="">
							</div>
							<a class="posts-title post-link" href="#">
								<h3 class="post-title"></h3>
							</a>
							<p class="excert post-excerpt"></p>
							<a href="#" class="primary-btn post-link">View More</a>
						</div>
					</div>
				</template>


				<nav class="blog-pagination justify-content-center d-flex">
					<ul class="pagination" id="posts-pagination"></ul>
				</nav>
				<script>
					function formatDateTime(value) {
						if (!value) {
							return "";
						}
						var date = new Date(value);
						if (isNaN(date.getTime())) {
							return "";
						}
						return new Intl.DateTimeFormat("en-GB", {
							day: "2-digit",
							month: "short",
							year: "numeric",
							hour: "2-digit",
							minute: "2-digit"
						}).format(date);
					}

					window.addEventListener('load', function () {
						if (!window.jQuery) {
							return;
						}

						var params = new URLSearchParams(window.location.search);
						var page = parseInt(params.get('page') || '1', 10);
						var apiUrl = "{% url 'blog:api-v1:post-list' %}?page=" + page;
						var defaultImage = "{% static 'img/blog/default.jpg' %}";
						var query = params.get('search');
						if (query) {
							apiUrl += "&search=" + encodeURIComponent(query);
						}
						var category = params.get('categories') || params.get('category');
						if (category) {
							apiUrl += "&categories=" + encodeURIComponent(category);
						}
						var author = params.get('author');
						if (author) {
							apiUrl += "&author=" + encodeURIComponent(author);
						}

						$.getJSON(apiUrl, function (data) {
							var posts = data.results || data;
							var $list = $("#posts-list");
							var $pagination = $("#posts-pagination");
							$list.empty();
							$pagination.empty();

							posts.forEach(function (p) {
								var $item = $($("#post-template").html());
								var imageUrl = p.image ? p.image : defaultImage;
								var categoriesInfo = Array.isArray(p.categories_info) ? p.categories_info : [];
								if (!categoriesInfo.length && Array.isArray(p.categories)) {
									categoriesInfo = p.categories.map(function (name) {
										return { name: name };
									});
								}
								var categoryLinks = categoriesInfo.map(function (cat) {
									var name = cat.name || "";
									var link = "{% url 'website:blog-home' %}";
									if (cat.id) {
										link += "?categories=" + encodeURIComponent(cat.id);
									} else {
										link = "#";
									}
									return '<a href="' + link + '">' + name + '</a>';
								}).join(", ");
								$item.find(".post-title").text(p.title || "");
								$item.find(".post-link").attr("href", (p.urls && p.urls.relative) ? p.urls.relative : "#");
								$item.find(".post-excerpt").text(p.excerpt || "");
								$item.find(".post-image").attr("src", imageUrl);
								var authorLink = "{% url 'website:blog-home' %}";
								if (p.author_id) {
									authorLink += "?author=" + encodeURIComponent(p.author_id);
								}
								$item.find(".post-author").attr("href", authorLink);
								$item.find(".post-author").text(p.author_name || "");
								$item.find(".post-category").html(categoryLinks);
								$item.find(".post-date").text(formatDateTime(p.created_date));
								$item.find(".post-views").text(p.counted_view || 0);
								$list.append($item);
							});

							if (data.number_of_pages) {
								for (var i = 1; i <= data.number_of_pages; i++) {
									var active = (i === page) ? " active" : "";
									var link = "?page=" + i;
									if (query) {
										link += "&search=" + encodeURIComponent(query);
									}
									if (category) {
										link += "&categories=" + encodeURIComponent(category);
									}
									if (author) {
										link += "&author=" + encodeURIComponent(author);
									}
									$pagination.append(
										'<li class="page-item' + active + '"><a class="page-link" href="' + link + '">' + i + '</a></li>'
									);
								}
							}
						});
					});
				</script>
			</div>
			<div class="col-lg-4 sidebar-widgets">
				<div class="widget-wrap">
					{% include 'blogApi/blog-search.html' %}
					{% include 'blogApi/blog-writer.html' %}

					{% include 'blogApi/blog-ads.html' %}
					
					{% include 'blogApi/blog-tags.html' %}
				</div>
			</div>
		</div>
	</div>
</section>
<!-- End post-content Area -->
{% endblock %}
